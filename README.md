# turd
Portfolio rebalancer for T-invest API

Как должен работать ребалансировщик:
1. Есть портфель акций, у них есть стоимость, у каждой акции есть доля в портфеле
2. Стоимость акций меняется и балансировщик при некоторых условиях продает и покупает акции
3. Условия могут быть разные, для TURD на lua это был индикатор из двух экспоненциальных скользящих средних, 12 пятиминуток и, кажется, 100 пятиминуток
4. Плюс пороги, следование трендам и прочее.

В этот раз я хочу получить что-то более интеллектуальное, с сохраненными данными, аналитикой сделок, веб-интерфейсом для мониторинга (не будет ведь никакого QUIK).
С возможностью ликвидировать или заменить позицию и прочее.

Если дела пойдут, можно будет через эту же штуку встроить мониторинг облигаций и т.п.

Пока план такой: У нас есть внешние данные (Тиньков) о свечах в инструментах. Мы их можем кешировать, а можем и нет. Рейтлимиты у Тинька есть. Но может оказаться, что достать из своего хранилища дороже, чем запросить свежее. Тем более, что исторические данные нам скорее всего не нужны вовсе, нужно какое-то окно в пятиминутках, например, в 300 последних свечей. Можно считать VMA по ним. А можно из тинька тянуть только свежие серии свечей (по сути - последнюю цену и объем), данные для расчета брать из хранилища и писать туда же результаты расчетов (последнюю свечу как раз не писать, пока не закроется). Нам нужна рассчитанная VMA в окне, скажем, 100, и перерасчет с новыми данными и вытеснением влияния первого элемента.

Хз, что тут лучше подходит в качестве хранилища, монга или еще что, не вижу причин, почему бы эту хрень не хранить вообще одним документом (обновлять, получается, раз в 5 минут, это норм). В документе будет список кортежей или еще что-то такое, нам не нужны прямо все данные по свечам, нам нужна длина и время последней свечи, видимо.

Но так не построишь график VMA.

А в принципе можно и не хранить, можно в памяти держать.